<!--<!DOCTYPE html>-->
<!--<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="en">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title>Chat Room</title>-->
<!--    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">-->
<!--    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>-->
<!--    <link rel="stylesheet" type="text/css" th:href="@{/chatroom.css}">-->
<!--    <script type="importmap">-->
<!--        {-->
<!--          "imports": {-->
<!--            "@stomp/stompjs": "https://ga.jspm.io/npm:@stomp/stompjs@7.0.0/esm6/index.js"-->
<!--          }-->
<!--        }-->
<!--    </script>-->
<!--    <script type="module" th:src="@{/clientWebSocket.js}"></script>-->

<!--</head>-->
<!--<body>-->
<!--<div class="container">-->
<!--    <div class="welcome-header">-->
<!--        <h1 th:text="'Welcome to ' + ${currentChat.name} + ' Chat Room'">Welcome to the Chat Room</h1>-->
<!--    </div>-->
<!--    <div sec:authorize="isAuthenticated()" class="mb-3 text-center mt-4">-->
<!--        <div class="user-info d-inline-block p-3 rounded" style="background-color: #e9ecef; border: 1px solid #ced4da;">-->
<!--            <strong>User:</strong> <span th:text="${userName}">?</span>-->
<!--            <br>-->
<!--           &lt;!&ndash; <strong>Roles:</strong> <span sec:authentication="principal.authorities">[ROLE_USER, ROLE_ADMIN]</span>&ndash;&gt;-->
<!--        </div>-->
<!--        <form th:action="@{/logout}" method="post" class="d-inline-block ms-3">-->
<!--            <button type="submit" class="btn btn-danger">Logout</button>-->
<!--        </form>-->
<!--    </div>-->

<!--    <div class="row mb-3">-->
<!--        <div class="col-12">-->
<!--            <h2 th:text="${currentChat.name}">Chat Room Name</h2>-->
<!--            <p th:text="${currentChat.description}">Chat Room Description</p>-->
<!--        </div>-->
<!--    </div>-->
<!--    <div class="row">-->
<!--        <div class="col-md-3">-->
<!--            <h2>Chat Rooms</h2>-->
<!--            <ul class="list-group" id="chatroom-list">-->
<!--                <li class="list-group-item d-flex justify-content-between align-items-center" th:each="room : ${chatRoomsList}">-->
<!--                    <span th:text="${room.name}">Room Name</span>-->
<!--                    <div>-->
<!--                        <form th:action="@{'/chatroom/' + ${room.id}}" method="get" style="display:inline">-->
<!--                            <button type="submit" class="btn btn-primary btn-sm" th:disabled="${room.id} == ${currentChat.id}">Join</button>-->
<!--                        </form>-->
<!--                        <form th:action="@{'/deleteChatRoom/' + ${room.id}}" method="post" style="display:inline">-->
<!--                            <button type="submit" class="btn btn-danger btn-sm" th:disabled="${room.name} == 'Home'">Remove</button>-->
<!--                        </form>-->
<!--                    </div>-->
<!--                </li>-->
<!--            </ul>-->
<!--            <form th:action="@{/addChatRoom}" method="post" th:object="${chatRoom}" class="mt-3">-->
<!--                <div class="form-group">-->
<!--                    <label for="name">Chat Room Name</label>-->
<!--                    <input type="text" class="form-control" id="name" th:field="*{name}" placeholder="Enter chat room name">-->
<!--                    <small class="text-danger" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></small>-->
<!--                </div>-->
<!--                <button type="submit" class="btn btn-primary mt-3">Add ChatRoom</button>-->
<!--            </form>-->
<!--            <div th:if="${errorAddChatRoom}" class="alert alert-danger mt-3" role="alert">-->
<!--                <p th:text="${errorAddChatRoom}"></p>-->
<!--            </div>-->
<!--        </div>-->
<!--        <div class="col-md-9 chat-container">-->
<!--            <div id="chat" class="chat-box d-flex flex-column">-->
<!--                <div th:each="message : ${messages}">-->
<!--                    <div th:class="${message.user.username == #authentication.name} ? 'chat-message outgoing-message' : 'chat-message incoming-message'">-->
<!--                        <div><strong th:text="${message.user.username}">User</strong> <span class="text-muted" style="font-size: smaller;" th:text="${message.createdAt}">Time</span></div>-->
<!--                        <div th:text="${message.message}"></div>-->
<!--                    </div>-->
<!--                </div>-->
<!--                <div id="responseBody"></div>-->
<!--            </div>-->
<!--            <div class="message-input">-->
<!--                <input type="text" id="user-message-content" class="form-control" placeholder="Type your message...">-->
<!--                <button id="send-message" class="btn btn-primary">Send</button>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--    <div class="text-center mt-3">-->
<!--        <a th:href="@{/}" class="btn btn-secondary">Back to Home Page</a>-->
<!--    </div>-->
<!--    &lt;!&ndash;<input id="username" th:value="*{#authentication.name}" hidden>&ndash;&gt;-->
<!--    <input id="username" th:value="*{userName}" hidden>-->
<!--    <input id="chat-room-id" th:value="*{currentChat.id}" hidden>-->
<!--</div>-->
<!--<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>-->
<!--</body>-->
<!--</html>-->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat Room</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" th:href="@{/chatroom.css}">
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script type="importmap">
        {
          "imports": {
            "@stomp/stompjs": "https://ga.jspm.io/npm:@stomp/stompjs@7.0.0/esm6/index.js"
          }
        }
    </script>
    <script type="module" th:src="@{/clientWebSocket.js}"></script>
    <style>
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 70vh;
        }
        .chat-box {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            padding: 10px;
            background-color: #f8f9fa;
        }
        .message-input {
            display: flex;
            gap: 10px;
        }
        .chat-message {
            margin-bottom: 10px;
        }
        .outgoing-message {
            text-align: right;
        }
        .incoming-message {
            text-align: left;
        }
    </style>
</head>
<body>
<div th:replace="fragments/header :: header"></div>

<div class="container mt-4">
    <div class="row mb-3">
        <div class="col-12 text-center">
            <h2 th:text="${currentChat.name}">Chat Room Name</h2>
            <p th:text="${currentChat.description}">Chat Room Description</p>
        </div>
    </div>
    <div class="row">
        <div class="col-md-3">
            <h2>Chat Rooms</h2>
            <ul class="list-group" id="chatroom-list">
                <li class="list-group-item d-flex justify-content-between align-items-center" th:each="room : ${chatRoomsList}">
                    <span th:text="${room.name}">Room Name</span>
                    <div>
                        <form th:action="@{'/chatroom/' + ${room.id}}" method="get" style="display:inline">
                            <button type="submit" class="btn btn-primary btn-sm" th:disabled="${room.id} == ${currentChat.id}">Join</button>
                        </form>
                        <form th:action="@{'/deleteChatRoom/' + ${room.id}}" method="post" style="display:inline">
                            <button type="submit" class="btn btn-danger btn-sm" th:disabled="${room.name} == 'Home'">Remove</button>
                        </form>
                    </div>
                </li>
            </ul>
            <form th:action="@{/addChatRoom}" method="post" th:object="${chatRoom}" class="mt-3">
                <div class="form-group">
                    <label for="name">Chat Room Name</label>
                    <input type="text" class="form-control" id="name" th:field="*{name}" placeholder="Enter chat room name">
                    <small class="text-danger" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></small>
                </div>
                <button type="submit" class="btn btn-primary mt-3">Add ChatRoom</button>
            </form>
            <div th:if="${errorAddChatRoom}" class="alert alert-danger mt-3" role="alert">
                <p th:text="${errorAddChatRoom}"></p>
            </div>
        </div>
        <div class="col-md-9 chat-container">
            <div id="chat" class="chat-box d-flex flex-column">
                <div th:each="message : ${messages}">
                    <div th:class="${message.user.username == #authentication.name} ? 'chat-message outgoing-message' : 'chat-message incoming-message'">
                        <div><strong th:text="${message.user.username}">User</strong> <span class="text-muted" style="font-size: smaller;" th:text="${message.createdAt}">Time</span></div>
                        <div th:text="${message.message}"></div>
                    </div>
                </div>
                <div id="responseBody"></div>
            </div>
            <div class="message-input mt-3">
                <input type="text" id="user-message-content" class="form-control" placeholder="Type your message...">
                <button id="send-message" class="btn btn-primary">Send</button>
            </div>
        </div>
    </div>
    <div class="text-center mt-3">
        <a th:href="@{/}" class="btn btn-secondary">Back to Home Page</a>
    </div>
    <input id="username" th:value="*{userName}" hidden>
    <input id="chat-room-id" th:value="*{currentChat.id}" hidden>
</div>

<div th:replace="fragments/footer :: footer"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
</body>
</html>
